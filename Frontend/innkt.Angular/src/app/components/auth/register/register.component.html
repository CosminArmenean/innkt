<div class="register-container">
  <mat-card class="register-card">
    <mat-card-header>
      <mat-card-title>{{ 'REGISTER.TITLE' | translate }}</mat-card-title>
      <mat-card-subtitle>{{ 'REGISTER.SUBTITLE' | translate }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.FIRST_NAME' | translate }}</mat-label>
            <input matInput formControlName="firstName" placeholder="{{ 'REGISTER.FIRST_NAME_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
              {{ getErrorMessage('firstName') }}
            </mat-error>
            <mat-error *ngIf="registerForm.get('firstName')?.hasError('minlength')">
              {{ getErrorMessage('firstName') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.LAST_NAME' | translate }}</mat-label>
            <input matInput formControlName="lastName" placeholder="{{ 'REGISTER.LAST_NAME_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
              {{ getErrorMessage('lastName') }}
            </mat-error>
            <mat-error *ngIf="registerForm.get('lastName')?.hasError('minlength')">
              {{ getErrorMessage('lastName') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.EMAIL' | translate }}</mat-label>
            <input matInput formControlName="email" type="email" placeholder="{{ 'REGISTER.EMAIL_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
              {{ getErrorMessage('email') }}
            </mat-error>
            <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
              {{ getErrorMessage('email') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.EMAIL_CONFIRMATION' | translate }}</mat-label>
            <input matInput formControlName="emailConfirmation" type="email" placeholder="{{ 'REGISTER.EMAIL_CONFIRMATION_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('emailConfirmation')?.hasError('required')">
              {{ getErrorMessage('emailConfirmation') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.PASSWORD' | translate }}</mat-label>
            <input matInput formControlName="password" type="password" placeholder="{{ 'REGISTER.PASSWORD_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
              {{ getErrorMessage('password') }}
            </mat-error>
            <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
              {{ getErrorMessage('password') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.PASSWORD_CONFIRMATION' | translate }}</mat-label>
            <input matInput formControlName="passwordConfirmation" type="password" placeholder="{{ 'REGISTER.PASSWORD_CONFIRMATION_PLACEHOLDER' | translate }}">
            <mat-error *ngIf="registerForm.get('passwordConfirmation')?.hasError('required')">
              {{ getErrorMessage('passwordConfirmation') }}
            </mat-error>
            <mat-error *ngIf="registerForm.get('passwordConfirmation')?.hasError('passwordMismatch')">
              {{ getErrorMessage('passwordConfirmation') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>{{ 'REGISTER.LANGUAGE' | translate }}</mat-label>
            <mat-select formControlName="language">
              <mat-option *ngFor="let lang of languages" [value]="lang.code">
                {{ lang.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Joint Account Section -->
        <div class="joint-account-section">
          <mat-checkbox formControlName="isJointAccount" color="primary">
            {{ 'REGISTER.JOINT_ACCOUNT' | translate }}
          </mat-checkbox>
          
          <mat-expansion-panel *ngIf="showJointAccount" class="joint-account-panel">
            <mat-expansion-panel-header>
              <mat-panel-title>{{ 'REGISTER.JOINT_ACCOUNT_DETAILS' | translate }}</mat-panel-title>
            </mat-expansion-panel-header>

            <div class="joint-account-form" [formGroup]="jointAccountForm">
              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_FIRST_NAME' | translate }}</mat-label>
                  <input matInput formControlName="secondUserFirstName" placeholder="{{ 'REGISTER.SECOND_USER_FIRST_NAME_PLACEHOLDER' | translate }}">
                  <mat-error *ngIf="jointAccountForm.get('secondUserFirstName')?.hasError('required')">
                    {{ getJointAccountErrorMessage('secondUserFirstName') }}
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_LAST_NAME' | translate }}</mat-label>
                  <input matInput formControlName="secondUserLastName" placeholder="{{ 'REGISTER.SECOND_USER_LAST_NAME_PLACEHOLDER' | translate }}">
                  <mat-error *ngIf="jointAccountForm.get('secondUserLastName')?.hasError('required')">
                    {{ getJointAccountErrorMessage('secondUserLastName') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_PASSWORD' | translate }}</mat-label>
                  <input matInput formControlName="secondUserPassword" type="password" placeholder="{{ 'REGISTER.SECOND_USER_PASSWORD_PLACEHOLDER' | translate }}">
                  <mat-error *ngIf="jointAccountForm.get('secondUserPassword')?.hasError('required')">
                    {{ getJointAccountErrorMessage('secondUserPassword') }}
                  </mat-error>
                  <mat-error *ngIf="jointAccountForm.get('secondUserPassword')?.hasError('minlength')">
                    {{ getJointAccountErrorMessage('secondUserPassword') }}
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_PASSWORD_CONFIRMATION' | translate }}</mat-label>
                  <input matInput formControlName="secondUserPasswordConfirmation" type="password" placeholder="{{ 'REGISTER.SECOND_USER_PASSWORD_CONFIRMATION_PLACEHOLDER' | translate }}">
                  <mat-error *ngIf="jointAccountForm.get('secondUserPasswordConfirmation')?.hasError('required')">
                    {{ getJointAccountErrorMessage('secondUserPasswordConfirmation') }}
                  </mat-error>
                  <mat-error *ngIf="jointAccountForm.get('secondUserPasswordConfirmation')?.hasError('passwordMismatch')">
                    {{ getJointAccountErrorMessage('secondUserPasswordConfirmation') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_COUNTRY_CODE' | translate }}</mat-label>
                  <input matInput formControlName="secondUserCountryCode" placeholder="+1">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_MOBILE_PHONE' | translate }}</mat-label>
                  <input matInput formControlName="secondUserMobilePhone" placeholder="{{ 'REGISTER.MOBILE_PHONE_PLACEHOLDER' | translate }}">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_BIRTH_DATE' | translate }}</mat-label>
                  <input matInput formControlName="secondUserBirthDate" type="date">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'REGISTER.SECOND_USER_GENDER' | translate }}</mat-label>
                  <mat-select formControlName="secondUserGender">
                    <mat-option value="male">{{ 'REGISTER.GENDER_MALE' | translate }}</mat-option>
                    <mat-option value="female">{{ 'REGISTER.GENDER_FEMALE' | translate }}</mat-option>
                    <mat-option value="other">{{ 'REGISTER.GENDER_OTHER' | translate }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </mat-expansion-panel>
        </div>

        <!-- GDPR Consent Section -->
        <div class="consent-section">
          <h3>{{ 'REGISTER.CONSENT_TITLE' | translate }}</h3>
          
          <div class="consent-checkboxes">
            <mat-checkbox formControlName="acceptTerms" color="primary" required>
              {{ 'REGISTER.ACCEPT_TERMS' | translate }}
            </mat-checkbox>
            
            <mat-checkbox formControlName="acceptPrivacyPolicy" color="primary" required>
              {{ 'REGISTER.ACCEPT_PRIVACY_POLICY' | translate }}
            </mat-checkbox>
            
            <mat-checkbox formControlName="acceptMarketing" color="primary">
              {{ 'REGISTER.ACCEPT_MARKETING' | translate }}
            </mat-checkbox>
            
            <mat-checkbox formControlName="acceptCookies" color="primary">
              {{ 'REGISTER.ACCEPT_COOKIES' | translate }}
            </mat-checkbox>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="!registerForm.valid || isLoading">
            <span *ngIf="!isLoading">{{ 'REGISTER.SUBMIT' | translate }}</span>
            <span *ngIf="isLoading">{{ 'REGISTER.SUBMITTING' | translate }}</span>
          </button>
          
          <button mat-button type="button" routerLink="/login">
            {{ 'REGISTER.ALREADY_HAVE_ACCOUNT' | translate }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
